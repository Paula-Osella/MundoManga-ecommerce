<form method="get" action="/products">
  <input type="text" name="search" placeholder="Buscar por nombre" value="{{search}}" />
  <select name="category">
    <option value="">Filtrar por categoría</option>
    <option value="Shonen" {{#if (eq category "Shonen")}}selected{{/if}}>Shonen</option>
    <option value="Seinen" {{#if (eq category "Seinen")}}selected{{/if}}>Seinen</option>
    <option value="Drama"  {{#if (eq category "Drama")}}selected{{/if}}>Drama</option>
  </select>

  <select name="sort">
    <option value="">Ordenar por precio</option>
    <option value="asc"  {{#if (eq sort "asc")}}selected{{/if}}>Precio Menor</option>
    <option value="desc" {{#if (eq sort "desc")}}selected{{/if}}>Precio Mayor</option>
  </select>

  <button type="submit">Buscar</button>
</form>

<p id="successMessage" class="auth-message"></p>
<p id="errorMessage" class="auth-message-error"></p>

{{#if isValid}}
  <div class="products-grid-container">
    {{#each docs}}
      <div class="product-card">
        {{#if this.thumbnails.length}}
          <img src="{{this.thumbnails.[0]}}" alt="{{this.title}}" />
        {{else}}
          <img src="/images/placeholder.png" alt="No image available" />
        {{/if}}

        <h3 class="card-title">{{this.title}}</h3>

        <p class="card-desc card-desc--clamp" id="desc-{{this._id}}">
          {{this.description}}
        </p>
        <button type="button" class="toggle-desc" data-target="desc-{{this._id}}">
          Ver más
        </button>

        <p class="price">Precio: ${{this.price}}</p>

        <div class="qty-controls" data-id="{{this._id}}">
          <button type="button" class="btn-decrease" aria-label="Disminuir">−</button>
          <span class="qty" aria-live="polite">1</span>
          <button type="button" class="btn-increase" aria-label="Aumentar">+</button>
        </div>

        {{#if ../username}}
          <button class="add-to-cart" data-id="{{this._id}}">Agregar al carrito</button>
        {{else}}
          <a href="/login?error=Debes%20iniciar%20sesión" class="add-to-cart add-to-cart--ghost">Agregar al carrito</a>
        {{/if}}
      </div>
    {{/each}}
  </div>

  <div class="pagination-links">
    {{#if prevLink}} <a href="{{prevLink}}">&lt;&lt; Anterior</a> {{/if}}
    <span>Página {{page}}</span>
    {{#if nextLink}} <a href="{{nextLink}}">Siguiente &gt;&gt;</a> {{/if}}
  </div>
{{else}}
  <h1>No hay productos para mostrar</h1>
{{/if}}

<!-- Script de la vista (externo) -->
<script src="/js/products.js" defer></script>
